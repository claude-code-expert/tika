# 기능 명세: Create Ticket API

**기능 브랜치**: `001-create-ticket-api`
**생성일**: 2026-02-13
**상태**: 초안
**입력**: 사용자 설명: "POST /api/tickets 엔드포인트 구현"

## 사용자 시나리오 및 테스트 *(필수)*

### 사용자 스토리 1 - 기본 티켓 생성 (우선순위: P1)

사용자는 제목만으로 새 작업을 빠르게 기록하고 싶어 합니다. 시스템은 이 최소한의 입력을 받아들이고 합리적인 기본값으로 Backlog 칼럼에 티켓을 생성해야 합니다.

**이 우선순위인 이유**: 이것은 핵심 기능입니다 - 티켓 생성. 이것 없이는 다른 티켓 작업이 불가능합니다. 최소 실행 가능 기능을 나타냅니다.

**독립 테스트**: 제목만 포함된 POST 요청을 보내고 BACKLOG 상태와 기본값으로 티켓이 생성되었는지 확인하여 완전히 테스트할 수 있습니다.

**수락 시나리오**:

1. **주어진** 사용자가 새 작업을 만들고 싶을 때, **그때** 제목 "API 문서 작성"을 제출하면, **그러면** 시스템은 상태 BACKLOG, 우선순위 MEDIUM, 칼럼 최상단 위치로 티켓을 생성합니다
2. **주어진** 티켓 생성이 성공했을 때, **그때** 시스템이 응답하면, **그러면** 자동 생성된 id, createdAt, updatedAt을 포함한 완전한 티켓 데이터와 함께 HTTP 201을 반환합니다
3. **주어진** 새로 생성된 티켓이 있을 때, **그때** 위치를 확인하면, **그러면** BACKLOG 칼럼의 최상단에 나타납니다 (position = min(기존 positions) - 1024)

---

### 사용자 스토리 2 - 상세 티켓 생성 (우선순위: P2)

사용자는 설명, 우선순위, 시작 예정일, 마감일을 포함한 모든 사용 가능한 정보를 제공하여 포괄적인 티켓을 만들고 싶어 합니다. 시스템은 이러한 모든 선택적 필드를 수락하고 검증해야 합니다.

**이 우선순위인 이유**: 기본 티켓 생성은 필수이지만, 많은 작업에는 추가 컨텍스트와 일정이 필요합니다. 이는 더 나은 작업 계획 및 우선순위 지정을 가능하게 합니다.

**독립 테스트**: 모든 필드가 채워진 POST 요청을 보내고 각 필드가 올바르게 저장되고 반환되는지 확인하여 테스트할 수 있습니다.

**수락 시나리오**:

1. **주어진** 사용자가 상세한 작업 정보를 가지고 있을 때, **그때** 제목, 설명, 우선순위 HIGH, plannedStartDate "2026-02-10", dueDate "2026-02-15"를 제출하면, **그러면** 시스템은 지정된 모든 값이 보존된 티켓을 생성합니다
2. **주어진** 마감일이 있는 티켓이 생성될 때, **그때** 시스템이 날짜를 검증하면, **그러면** 오늘 또는 미래 날짜를 수락합니다
3. **주어진** HIGH 우선순위로 티켓이 생성될 때, **그때** 티켓을 보면, **그러면** 우선순위 필드가 지정된 대로 "HIGH"를 표시합니다

---

### 사용자 스토리 3 - 잘못된 입력 처리 (우선순위: P3)

사용자가 티켓을 생성할 때 잘못된 데이터(빈 제목, 너무 긴 설명, 잘못된 날짜 등)를 제출합니다. 시스템은 요청을 거부하고 명확하고 실행 가능한 오류 메시지를 제공해야 합니다.

**이 우선순위인 이유**: 데이터 검증은 데이터 품질을 보장하고 사용자가 실수를 수정하도록 안내합니다. 중요하지만, 시스템은 초기에 완벽한 검증 없이도 작동할 수 있습니다.

**독립 테스트**: 다양한 잘못된 입력을 제출하고 명확한 메시지가 있는 적절한 오류 응답을 확인하여 테스트할 수 있습니다.

**수락 시나리오**:

1. **주어진** 사용자가 빈 제목으로 티켓을 제출할 때, **그때** 시스템이 입력을 검증하면, **그러면** 오류 코드 VALIDATION_ERROR와 메시지 "제목을 입력해주세요"와 함께 HTTP 400을 반환합니다
2. **주어진** 사용자가 201자의 제목으로 티켓을 제출할 때, **그때** 시스템이 입력을 검증하면, **그러면** 메시지 "제목은 200자 이내로 입력해주세요"와 함께 HTTP 400을 반환합니다
3. **주어진** 사용자가 1000자를 초과하는 설명으로 티켓을 제출할 때, **그때** 시스템이 입력을 검증하면, **그러면** 메시지 "설명은 1000자 이내로 입력해주세요"와 함께 HTTP 400을 반환합니다
4. **주어진** 사용자가 과거의 dueDate로 티켓을 제출할 때, **그때** 시스템이 날짜를 검증하면, **그러면** 메시지 "종료예정일은 오늘 이후 날짜를 선택해주세요"와 함께 HTTP 400을 반환합니다
5. **주어진** 사용자가 우선순위 "URGENT"로 티켓을 제출할 때, **그때** 시스템이 우선순위를 검증하면, **그러면** 메시지 "우선순위는 LOW, MEDIUM, HIGH 중 선택해주세요"와 함께 HTTP 400을 반환합니다
6. **주어진** 사용자가 제목으로 공백만 제출할 때, **그때** 시스템이 입력을 검증하면, **그러면** 메시지 "제목을 입력해주세요"와 함께 HTTP 400을 반환합니다

---

### 엣지 케이스

- 빈 BACKLOG 칼럼에서 여러 티켓이 동시에 생성되면 어떻게 되나요?
- BACKLOG에 이미 티켓이 있을 때 시스템은 위치 계산을 어떻게 처리하나요?
- 제목에 특수 문자나 유니코드(예: 이모지, 한글)가 포함되어 있으면 어떻게 되나요?
- 시스템은 createdAt 및 updatedAt 타임스탬프의 시간대를 어떻게 처리하나요?
- plannedStartDate는 제공되었지만 dueDate는 제공되지 않은 경우(또는 그 반대) 어떻게 되나요?

## 요구사항 *(필수)*

### 기능 요구사항

- **FR-001**: 시스템은 title(필수), description(선택), priority(선택), plannedStartDate(선택), dueDate(선택)를 포함하는 JSON 본문으로 /api/tickets에 대한 POST 요청을 수락해야 합니다
- **FR-002**: 시스템은 title이 1-200자 사이이고 공백만이 아닌지 검증해야 합니다
- **FR-003**: 시스템은 제공된 경우 description이 최대 1000자인지 검증해야 합니다
- **FR-004**: 시스템은 제공된 경우 priority가 LOW, MEDIUM 또는 HIGH 중 하나인지 검증해야 합니다
- **FR-005**: 시스템은 제공되지 않은 경우 priority를 MEDIUM으로 기본 설정해야 합니다
- **FR-006**: 시스템은 제공된 경우 dueDate가 YYYY-MM-DD 형식이고 오늘 또는 그 이후인지 검증해야 합니다
- **FR-007**: 시스템은 제공된 경우 plannedStartDate가 YYYY-MM-DD 형식인지 검증해야 합니다
- **FR-008**: 시스템은 새로 생성된 모든 티켓의 status를 BACKLOG로 자동 설정해야 합니다
- **FR-009**: 시스템은 position을 min(기존 BACKLOG positions) - 1024로 계산하여 새 티켓을 칼럼 최상단에 배치해야 합니다
- **FR-010**: 시스템은 createdAt 및 updatedAt을 Asia/Seoul 시간대의 현재 타임스탬프로 자동 설정해야 합니다
- **FR-011**: 시스템은 새로 생성된 티켓의 startedAt 및 completedAt을 null로 설정해야 합니다
- **FR-012**: 시스템은 성공적으로 생성되면 완전한 티켓 데이터와 함께 HTTP 201을 반환해야 합니다
- **FR-013**: 시스템은 검증 실패 시 code와 message를 포함하는 error 객체와 함께 HTTP 400을 반환해야 합니다
- **FR-014**: 시스템은 src/shared/validations/ticket.ts에 정의된 것과 동일한 Zod 검증 스키마를 사용해야 합니다
- **FR-015**: 시스템은 응답을 반환하기 전에 티켓 데이터를 데이터베이스에 저장해야 합니다

### 주요 엔티티

- **Ticket**: 다음 속성을 가진 작업 항목/작업을 나타냅니다:
  - 식별: id (자동 생성)
  - 콘텐츠: title (사용자 제공, 필수), description (사용자 제공, 선택)
  - 상태: status (시스템이 BACKLOG로 설정), position (시스템 계산)
  - 우선순위: priority (사용자 제공 또는 MEDIUM으로 기본 설정)
  - 일정: plannedStartDate (사용자 제공, 선택), dueDate (사용자 제공, 선택)
  - 워크플로: startedAt (새 티켓은 null), completedAt (새 티켓은 null)
  - 감사: createdAt (시스템 생성), updatedAt (시스템 생성)

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 사용자는 요청에서 응답까지 3초 이내에 기본 티켓(제목만)을 생성할 수 있습니다
- **SC-002**: 유효한 티켓 생성 요청의 95%가 오류 없이 첫 시도에 성공합니다
- **SC-003**: 모든 검증 오류는 문제와 해결 방법을 설명하는 명확한 한글 메시지를 제공합니다
- **SC-004**: 시스템은 데이터 손실이나 손상 없이 100개의 동시 티켓 생성 요청을 처리합니다
- **SC-005**: 새로 생성된 티켓은 일관되게 BACKLOG 칼럼의 최상단에 나타납니다
- **SC-006**: 생성된 모든 티켓은 Asia/Seoul 시간대로 적절하게 설정된 타임스탬프를 가집니다
- **SC-007**: 검증 오류 메시지는 API_SPEC.md의 명세와 정확히 일치합니다
